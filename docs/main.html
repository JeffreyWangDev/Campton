<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>skiskate.main API documentation</title>
<meta name="description" content="Main file for all code relating to the server" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>skiskate.main</code></h1>
</header>
<section id="section-intro">
<p>Main file for all code relating to the server</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Main file for all code relating to the server&#34;&#34;&#34;
import sqlite3 as sl
import werkzeug
from flask import Flask,redirect,render_template,request,url_for,jsonify, send_file
#from backend import *
import backend
app = Flask(__name__)

@app.route(&#39;/goto&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def goto():
    &#34;&#34;&#34;
    Redirects to the specified route based on the &#39;place&#39; query parameter.
    If &#39;place&#39; is not provided or the route doesn&#39;t exist, it redirects to the &#39;home&#39; route.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    place = request.args.get(&#39;place&#39;, None)
    try:
        return redirect(url_for(place))
    except werkzeug.routing.exceptions.BuildError:
        return redirect(url_for(&#34;home&#34;))

@app.route(&#39;/&#39;)
def home():
    &#34;&#34;&#34;
    Renders the &#39;home.html&#39; template with an optional &#39;msg&#39; query parameter.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    msg = request.args.get(&#39;msg&#39;, None)
    return render_template(&#34;home.html&#34;,msg=msg)
@app.route(&#39;/make&#39;)
def make():
    &#34;&#34;&#34;
    Initializes the database tables if they don&#39;t already exist.

    Returns:
        A simple confirmation message.
    &#34;&#34;&#34;
    acc = sl.connect(&#39;main.db&#39;)
    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS user (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                sellerid TEXT NOT NULL,
                phone INTEGER NOT NULL,
                name TEXT,
                address TEXT, 
                city TEXT,
                state TEXT,
                zip TEXT,
                paid INTEGER
            );
        &#34;&#34;&#34;)

    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS items (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                sellerphone INTEGER NOT NULL,
                sellerid TEXT NOT NULL, 
                itemid TEXT NOT NULL, 
                itemprice INTEGER NOT NULL, 
                itemname TEXT NOT NULL,
                itemdisc TEXT,
                itemstatus INTEGER NOT NULL,
                itemcid TEXT NOT NULL
            );
        &#34;&#34;&#34;)


    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS log (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                event STRING,
                ip STRING,
                useragent STRING,
                time INTGER
            );
        &#34;&#34;&#34;)

    return &#34;Done&#34;
@app.route(&#39;/register&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def register():
    &#34;&#34;&#34;
    Handles user registration. Accepts POST requests to register a new user.
    Displays a registration form and error messages on GET requests.

    Returns:
        - On successful registration, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;register.html&#39; template with error and message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    msg = request.args.get(&#39;msg&#39;, None)
    if request.method == &#39;POST&#39;:
        a = backend.newseller(request)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;User added&#34;))
    return render_template(&#39;register.html&#39;, error=error,msg=msg)

@app.route(&#39;/r2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def register2():
    &#34;&#34;&#34;
    Handles user registration form submission. Goes to &#39;register&#39; with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        a = backend.newseller(request)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;register&#39;, msg=&#34;User added&#34;))
    return redirect(url_for(&#39;register&#39;, error=error))

@app.route(&#39;/seller&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def seller():
    &#34;&#34;&#34;
    Handles seller information display and form submission for seller search.

    Returns:
        - On successful seller info retrieval, renders the &#39;user.html&#39; template with seller details.
        - On error or POST request, renders the &#39;user.html&#39; template with error message.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        a = list(backend.getseller(request.form[&#39;phonenn&#39;]))
        if a[0]==0:
            aa = list(a[1])
            aa[2] = backend.phone_format(str(aa[2])).replace(&#34;-&#34;,&#34; &#34;)
            return render_template(&#39;user.html&#39;, user=aa)
        else:
            error = a[1]
    return render_template(&#34;user.html&#34;, error=error)

@app.route(&#39;/update&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def update():
    &#34;&#34;&#34;
    Handles user profile update. Accepts POST requests to update user information.
    Displays a user update form and error messages on GET requests.

    Returns:
        - On successful update, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;user.html&#39; template for user profile update.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    user = request.args.get(&#39;user&#39;, None)
    if request.method == &#39;POST&#39;:
        a = backend.updateseller(request)
        if a !=0:
            error = a
            phone = request.form[&#39;phonen&#39;]
            name = request.form[&#39;name&#39;]
            address = request.form[&#39;address&#39;]
            city = request.form[&#39;city&#39;]
            state = request.form[&#39;state&#39;]
            zip_code = request.form[&#39;zip&#39;]
            user = (1,1,phone,name,address,city,state,zip_code)
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;User updated&#34;))
    return render_template(&#34;user.html&#34;, uerror=error , user = user)

@app.route(&#39;/u2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def update2():
    &#34;&#34;&#34;
    Redirects to the &#39;seller&#39; route.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    return redirect(url_for(&#39;seller&#39;))

@app.route(&#39;/newitem&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def newitem():
    &#34;&#34;&#34;
    Handles item creation. Accepts POST requests to add a new item.
    Displays an item creation form and error messages on GET requests.

    Returns:
        - On successful item creation, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;newitem.html&#39; template with error and phone information.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    phone = request.args.get(&#39;phone&#39;, None)
    msg = request.args.get(&#39;msg&#39;, None)
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
                print(&#34;here&#34;)
        else:
            name = request.form[&#39;name&#39;]
        a = backend.nitem(request,name)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;Item added&#34;))
    if phone:
        return render_template(&#34;newitem.html&#34;,error = error,phone = phone,msg=msg)
    return render_template(&#34;newitem.html&#34;,error = error,msg=msg)

@app.route(&#39;/i2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def newitem2():
    &#34;&#34;&#34;
    Handles item creation form submission. Redirects to &#39;newitem&#39; with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
        else:
            name = request.form[&#39;name&#39;]
        a = backend.nitem(request,name)
        if a !=0:
            error = a
            return redirect(url_for(&#39;newitem&#39;, error=error,phone=request.form[&#39;phonen&#39;]))
        else:
            return redirect(url_for(&#39;newitem&#39;, msg=&#34;Item added&#34;,phone=request.form[&#39;phonen&#39;]))
            #return redirect(url_for(&#39;newitem&#39;, msg=&#34;Item added&#34;))
    return redirect(url_for(&#39;newitem&#39;, error=error))

@app.route(&#39;/item&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def item():
    &#34;&#34;&#34;
    Handles item information display and form submission for item search.

    Returns:
        - On successful item retrieval, renders the &#39;item.html&#39; template with item details.
        - On error or POST request, renders the &#39;item.html&#39; template with error message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    item_data = request.args.get(&#39;item&#39;, None)
    try:
        item_data = item_data.split(&#34;_____&#34;)
        if item_data[0] == &#34;0&#34;:
            pass
        else:
            raise ValueError
    except (ValueError, IndexError):
        item_data = None
    if item_data:
        return render_template(&#39;item.html&#39;,item = item_data,ierror=error)
    if request.method == &#39;POST&#39;:
        a = list(backend.getitem(request.form[&#39;tid&#39;]))
        if a[0]==1:
            item_data = list(a[1][0])
            item_data[1] = backend.phone_format(str(item_data[1])).replace(&#34;-&#34;,&#34; &#34;)
            if item_data[7] ==0:
                item_data[7]=&#34;Not Sold&#34;
            elif item_data[7]==1:
                item_data[7] = &#34;Sold&#34;
            elif item_data[7] == 2:
                item_data[7] = &#34;Paid&#34;
            elif item_data[7] == 3:
                item_data[7] = &#34;Returned&#34;
            return render_template(&#39;item.html&#39;,item = item)
        else:
            error = a[1]
    return render_template(&#34;item.html&#34;, error=error)

@app.route(&#39;/itemu&#39;, methods=[ &#39;POST&#39;])
def itemu():
    &#34;&#34;&#34;
    Handles item update form submission. Redirects to the &#39;item&#39; route with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
        else:
            name = request.form[&#39;name&#39;]
        a = backend.updateitem(request,name)
        if a==0:
            return redirect(url_for(&#34;home&#34;,msg = &#34;Item updated&#34;))
        else:
            item_data =&#34;&#34;.join(str(e)+&#34;_____&#34; for e in[
                0,
                request.form[&#39;phonen&#39;],
                0,
                request.form[&#39;id&#39;],
                request.form[&#39;price&#39;],
                request.form[&#39;name&#39;],
                request.form[&#39;dis&#39;],
                request.form[&#39;sold&#39;],
                request.form[&#39;cid&#39;]])
            return redirect(url_for(&#34;item&#34;,error = a,item=item_data))

@app.route(&#39;/report&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def report():
    &#34;&#34;&#34;
    Handles seller report generation and display. Accepts POST requests to generate reports.
    Displays a report form and error messages on GET requests.

    Returns:
        - On successful report gen, renders the &#39;reporta.html&#39; template with seller/item info.
        - On error or POST request, renders the &#39;report.html&#39; template with error message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    if request.method == &#39;POST&#39;:
        a =backend.getreport(request.form[&#39;phonen&#39;])
        b = backend.getseller(request.form[&#39;phonen&#39;])
        max_amount = 0
        notsold = 0
        sold = 0
        if a[0] ==0:

            current_item =a[1]
            b = list(b[1])
            c=[]
            for i in current_item:
                i = list(i)
                if i[7] ==0:
                    i[7]=&#34;Not Sold&#34;
                    notsold=notsold+1
                elif i[7]==1:
                    i[7] = &#34;Sold&#34;
                    max_amount =max_amount+i[4]
                    sold=sold+1
                elif i[7] == 2:
                    i[7] = &#34;Paid&#34;
                    sold=sold+1
                elif i[7] == 3:
                    i[7] = &#34;Returned&#34;
                c.append(i)
            b[2] = backend.phone_format(str(b[2])).replace(&#34;-&#34;,&#34; &#34;)
            pay = max_amount*7
            pay=pay/10
            if &#34;.&#34;in str(pay):
                paya = str(pay).split(&#34;.&#34;)
                pay = paya[0]+&#34;.&#34;+paya[1][:2]
            return render_template(
            &#34;reporta.html&#34;,
            item = c,
            user =b,
            max = max_amount,
            sold=sold,
            notsold=notsold,
            payout = pay)
        else:
            error = a
    return render_template(&#34;report.html&#34;,error=error)

@app.route(&#39;/r&#39;, methods=[&#39;POST&#39;])
def reportapi():
    &#34;&#34;&#34;
    Handles API requests to generate seller reports.

    Returns:
        - On successful report generation, returns a JSON response with a status message.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    pnum =request.json[&#34;phone&#34;]
    b = backend.getseller(pnum)
    if b[1][8]:
        return(jsonify({&#34;status&#34;:&#34;Error: Report already generated for this user&#34;}),418)
    a =backend.reporta(request)
    if a ==0:
        #return redirect(url_for(&#34;home&#34;,msg = &#34;Changed all items sold to paid&#34;))
        return(jsonify({&#34;status&#34;:&#34;done&#34;}),200)
    return 404

@app.route(&#39;/print_report&#39;)
def print_report():
    &#34;&#34;&#34;
    Handles seller report printing.

    Returns:
        Renders the &#39;rec.html&#39; template with seller and item details.
    &#34;&#34;&#34;
    phone = request.args.get(&#39;phone&#39;, None)
    if phone:
        a =backend.getreport(phone)
        b = backend.getseller(phone)
        max_amount = 0
        notsold = 0
        sold = 0
        if a[0] ==0:
            current_item =a[1]
            b = list(b[1])
            c=[]
            for i in current_item:
                i = list(i)
                if i[7] ==0:
                    i[7]=&#34;Not Sold&#34;
                    notsold=notsold+1
                elif i[7]==1:
                    i[7] = &#34;Sold&#34;
                    max_amount =max_amount+i[4]
                    sold=sold+1
                elif i[7] == 2:
                    i[7] = &#34;Paid&#34;
                    sold=sold+1
                    max_amount =max_amount+i[4]
                elif i[7] == 3:
                    i[7] = &#34;Returned&#34;
                c.append(i)
            b[2] = backend.phone_format(str(b[2])).replace(&#34;-&#34;,&#34; &#34;)
            pay = max_amount*0.7
            if &#34;.&#34;in str(pay):
                paya = str(pay).split(&#34;.&#34;)
                pay = paya[0]+&#34;.&#34;+paya[1][:2]
            return render_template(
                &#34;rec.html&#34;, 
                item = c,
                user =b,
                sold=sold,
                payout = pay,
                seller = b[3],
                phone = b[2],
                address=b[4])

    return redirect(url_for(&#34;report&#34;))
@app.route(&#39;/print&#39;)
def print_api():
    &#34;&#34;&#34;
    Redirects to the &#39;report&#39; route for report printing.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    return redirect(url_for(&#34;report&#34;))

@app.route(&#39;/checkout&#39;)
def checkout():
    &#34;&#34;&#34;
    Renders the &#39;checkout.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;checkout.html&#34;)
@app.route(&#39;/api/getitem&#39;)
def api_getitem():
    &#34;&#34;&#34;
    Handles API requests to retrieve item details.

    Returns:
        - On successful item retrieval, returns a JSON response with item data.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    num = request.args.get(&#39;itemnum&#39;, None)
    a = backend.getitem(num)
    return({&#34;res&#34;:a[0],&#34;data&#34;:a[1]})
@app.route(&#39;/api/postitems&#39;, methods=[&#39;POST&#39;])
def api_postitems():
    &#34;&#34;&#34;
    Handles API requests to post items.

    Returns:
        - On successful item update, returns a JSON response with a status message.
        - On error, returns a JSON response with an error status and code 412 or 418.
    &#34;&#34;&#34;
    content = request.json
    a = backend.postitems(content,request)
    if a[0] == 0:
        return jsonify({&#34;status&#34;:&#34;updated&#34;})
    elif a[0] ==1:
        return jsonify({&#34;status&#34;:a[1]}),412
    else:
        return jsonify({&#34;status&#34;:a[1]}),418

@app.route(&#39;/logs&#39;)
def logs():
    &#34;&#34;&#34;
    Renders the &#39;logs.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;logs.html&#34;)

@app.route(&#39;/api/getlog&#39;, methods=[&#39;POST&#39;])
def api_getlog():
    &#34;&#34;&#34;
    Handles API requests to retrieve logs.

    Returns:
        - On successful log retrieval, returns a JSON response with log data.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    a=backend.getlog(request.json[&#34;password&#34;])
    if a[0]==1:
        return({&#34;res&#34;:a[0],&#34;data&#34;:a[1]})
    return(jsonify({&#34;res&#34;:a[0],&#34;data&#34;:a[1]}),418)


@app.route(&#39;/api/db&#39;)
def api_downloadlog():
    &#34;&#34;&#34;
    Handles API requests to download database logs.

    Returns:
        Renders the &#39;down.html&#39; template for download.
    &#34;&#34;&#34;
    a = backend.getall()
    things = [&#34;user&#34;,&#34;items&#34;,&#34;log&#34;]
    count = 0
    for i in a:
        with open(f&#34;./download/{things[count]}.csv&#34;, &#39;w&#39;, encoding=&#34;utf-8&#34;) as f:
            for k in i:
                add = &#34;0&#34;
                for j in k:
                    if j:
                        add=add+&#34;,&#34;+str(j)
                    else:
                        add=add+&#34;,&#34;+&#34;NONE&#34;
                f.write(add)
                f.write(&#34;\n&#34;)
        count = count+1
    #return send_from_directory(directory=&#39;logs&#39;)
    return render_template(&#34;down.html&#34;)
@app.route(&#39;/down/&lt;filename&gt;&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def download(filename):
    &#34;&#34;&#34;
    Handles file download requests.

    Args:
        filename (str): Name of the file to be downloaded.

    Returns:
        - On success, serves the requested file for download.
        - On error (file not found), returns an error message.
    &#34;&#34;&#34;
    if filename not in [&#34;user.csv&#34;,&#34;items.csv&#34;,&#34;log.csv&#34;]:
        return &#34;File does not exist&#34;
    try:
        return send_file(f&#34;./download/{filename}&#34;)
    except FileNotFoundError:
        return &#34;File does not exist&#34;

@app.route(&#34;/download/database&#34;)
def download_db():
    &#34;&#34;&#34;
    Handles database download requests.

    Returns:
        Serves the main database file for download.
    &#34;&#34;&#34;
    return send_file(&#34;main.db&#34;)

@app.route(&#34;/admin&#34;)
def admin():
    &#34;&#34;&#34;
    Renders the &#39;admin.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;admin.html&#34;)

if __name__ == &#34;__main__&#34;:
    app.run()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="skiskate.main.admin"><code class="name flex">
<span>def <span class="ident">admin</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Renders the 'admin.html' template.</p>
<h2 id="returns">Returns</h2>
<p>Flask template render response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#34;/admin&#34;)
def admin():
    &#34;&#34;&#34;
    Renders the &#39;admin.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;admin.html&#34;)</code></pre>
</details>
</dd>
<dt id="skiskate.main.api_downloadlog"><code class="name flex">
<span>def <span class="ident">api_downloadlog</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles API requests to download database logs.</p>
<h2 id="returns">Returns</h2>
<p>Renders the 'down.html' template for download.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/api/db&#39;)
def api_downloadlog():
    &#34;&#34;&#34;
    Handles API requests to download database logs.

    Returns:
        Renders the &#39;down.html&#39; template for download.
    &#34;&#34;&#34;
    a = backend.getall()
    things = [&#34;user&#34;,&#34;items&#34;,&#34;log&#34;]
    count = 0
    for i in a:
        with open(f&#34;./download/{things[count]}.csv&#34;, &#39;w&#39;, encoding=&#34;utf-8&#34;) as f:
            for k in i:
                add = &#34;0&#34;
                for j in k:
                    if j:
                        add=add+&#34;,&#34;+str(j)
                    else:
                        add=add+&#34;,&#34;+&#34;NONE&#34;
                f.write(add)
                f.write(&#34;\n&#34;)
        count = count+1
    #return send_from_directory(directory=&#39;logs&#39;)
    return render_template(&#34;down.html&#34;)</code></pre>
</details>
</dd>
<dt id="skiskate.main.api_getitem"><code class="name flex">
<span>def <span class="ident">api_getitem</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles API requests to retrieve item details.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful item retrieval, returns a JSON response with item data.</li>
<li>On error, returns a JSON response with an error status and code 418.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/api/getitem&#39;)
def api_getitem():
    &#34;&#34;&#34;
    Handles API requests to retrieve item details.

    Returns:
        - On successful item retrieval, returns a JSON response with item data.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    num = request.args.get(&#39;itemnum&#39;, None)
    a = backend.getitem(num)
    return({&#34;res&#34;:a[0],&#34;data&#34;:a[1]})</code></pre>
</details>
</dd>
<dt id="skiskate.main.api_getlog"><code class="name flex">
<span>def <span class="ident">api_getlog</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles API requests to retrieve logs.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful log retrieval, returns a JSON response with log data.</li>
<li>On error, returns a JSON response with an error status and code 418.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/api/getlog&#39;, methods=[&#39;POST&#39;])
def api_getlog():
    &#34;&#34;&#34;
    Handles API requests to retrieve logs.

    Returns:
        - On successful log retrieval, returns a JSON response with log data.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    a=backend.getlog(request.json[&#34;password&#34;])
    if a[0]==1:
        return({&#34;res&#34;:a[0],&#34;data&#34;:a[1]})
    return(jsonify({&#34;res&#34;:a[0],&#34;data&#34;:a[1]}),418)</code></pre>
</details>
</dd>
<dt id="skiskate.main.api_postitems"><code class="name flex">
<span>def <span class="ident">api_postitems</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles API requests to post items.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful item update, returns a JSON response with a status message.</li>
<li>On error, returns a JSON response with an error status and code 412 or 418.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/api/postitems&#39;, methods=[&#39;POST&#39;])
def api_postitems():
    &#34;&#34;&#34;
    Handles API requests to post items.

    Returns:
        - On successful item update, returns a JSON response with a status message.
        - On error, returns a JSON response with an error status and code 412 or 418.
    &#34;&#34;&#34;
    content = request.json
    a = backend.postitems(content,request)
    if a[0] == 0:
        return jsonify({&#34;status&#34;:&#34;updated&#34;})
    elif a[0] ==1:
        return jsonify({&#34;status&#34;:a[1]}),412
    else:
        return jsonify({&#34;status&#34;:a[1]}),418</code></pre>
</details>
</dd>
<dt id="skiskate.main.checkout"><code class="name flex">
<span>def <span class="ident">checkout</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Renders the 'checkout.html' template.</p>
<h2 id="returns">Returns</h2>
<p>Flask template render response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/checkout&#39;)
def checkout():
    &#34;&#34;&#34;
    Renders the &#39;checkout.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;checkout.html&#34;)</code></pre>
</details>
</dd>
<dt id="skiskate.main.download"><code class="name flex">
<span>def <span class="ident">download</span></span>(<span>filename)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles file download requests.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>filename</code></strong> :&ensp;<code>str</code></dt>
<dd>Name of the file to be downloaded.</dd>
</dl>
<h2 id="returns">Returns</h2>
<ul>
<li>On success, serves the requested file for download.</li>
<li>On error (file not found), returns an error message.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/down/&lt;filename&gt;&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def download(filename):
    &#34;&#34;&#34;
    Handles file download requests.

    Args:
        filename (str): Name of the file to be downloaded.

    Returns:
        - On success, serves the requested file for download.
        - On error (file not found), returns an error message.
    &#34;&#34;&#34;
    if filename not in [&#34;user.csv&#34;,&#34;items.csv&#34;,&#34;log.csv&#34;]:
        return &#34;File does not exist&#34;
    try:
        return send_file(f&#34;./download/{filename}&#34;)
    except FileNotFoundError:
        return &#34;File does not exist&#34;</code></pre>
</details>
</dd>
<dt id="skiskate.main.download_db"><code class="name flex">
<span>def <span class="ident">download_db</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles database download requests.</p>
<h2 id="returns">Returns</h2>
<p>Serves the main database file for download.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#34;/download/database&#34;)
def download_db():
    &#34;&#34;&#34;
    Handles database download requests.

    Returns:
        Serves the main database file for download.
    &#34;&#34;&#34;
    return send_file(&#34;main.db&#34;)</code></pre>
</details>
</dd>
<dt id="skiskate.main.goto"><code class="name flex">
<span>def <span class="ident">goto</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Redirects to the specified route based on the 'place' query parameter.
If 'place' is not provided or the route doesn't exist, it redirects to the 'home' route.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/goto&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def goto():
    &#34;&#34;&#34;
    Redirects to the specified route based on the &#39;place&#39; query parameter.
    If &#39;place&#39; is not provided or the route doesn&#39;t exist, it redirects to the &#39;home&#39; route.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    place = request.args.get(&#39;place&#39;, None)
    try:
        return redirect(url_for(place))
    except werkzeug.routing.exceptions.BuildError:
        return redirect(url_for(&#34;home&#34;))</code></pre>
</details>
</dd>
<dt id="skiskate.main.home"><code class="name flex">
<span>def <span class="ident">home</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Renders the 'home.html' template with an optional 'msg' query parameter.</p>
<h2 id="returns">Returns</h2>
<p>Flask template render response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/&#39;)
def home():
    &#34;&#34;&#34;
    Renders the &#39;home.html&#39; template with an optional &#39;msg&#39; query parameter.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    msg = request.args.get(&#39;msg&#39;, None)
    return render_template(&#34;home.html&#34;,msg=msg)</code></pre>
</details>
</dd>
<dt id="skiskate.main.item"><code class="name flex">
<span>def <span class="ident">item</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles item information display and form submission for item search.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful item retrieval, renders the 'item.html' template with item details.</li>
<li>On error or POST request, renders the 'item.html' template with error message.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/item&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def item():
    &#34;&#34;&#34;
    Handles item information display and form submission for item search.

    Returns:
        - On successful item retrieval, renders the &#39;item.html&#39; template with item details.
        - On error or POST request, renders the &#39;item.html&#39; template with error message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    item_data = request.args.get(&#39;item&#39;, None)
    try:
        item_data = item_data.split(&#34;_____&#34;)
        if item_data[0] == &#34;0&#34;:
            pass
        else:
            raise ValueError
    except (ValueError, IndexError):
        item_data = None
    if item_data:
        return render_template(&#39;item.html&#39;,item = item_data,ierror=error)
    if request.method == &#39;POST&#39;:
        a = list(backend.getitem(request.form[&#39;tid&#39;]))
        if a[0]==1:
            item_data = list(a[1][0])
            item_data[1] = backend.phone_format(str(item_data[1])).replace(&#34;-&#34;,&#34; &#34;)
            if item_data[7] ==0:
                item_data[7]=&#34;Not Sold&#34;
            elif item_data[7]==1:
                item_data[7] = &#34;Sold&#34;
            elif item_data[7] == 2:
                item_data[7] = &#34;Paid&#34;
            elif item_data[7] == 3:
                item_data[7] = &#34;Returned&#34;
            return render_template(&#39;item.html&#39;,item = item)
        else:
            error = a[1]
    return render_template(&#34;item.html&#34;, error=error)</code></pre>
</details>
</dd>
<dt id="skiskate.main.itemu"><code class="name flex">
<span>def <span class="ident">itemu</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles item update form submission. Redirects to the 'item' route with error or success msg.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/itemu&#39;, methods=[ &#39;POST&#39;])
def itemu():
    &#34;&#34;&#34;
    Handles item update form submission. Redirects to the &#39;item&#39; route with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
        else:
            name = request.form[&#39;name&#39;]
        a = backend.updateitem(request,name)
        if a==0:
            return redirect(url_for(&#34;home&#34;,msg = &#34;Item updated&#34;))
        else:
            item_data =&#34;&#34;.join(str(e)+&#34;_____&#34; for e in[
                0,
                request.form[&#39;phonen&#39;],
                0,
                request.form[&#39;id&#39;],
                request.form[&#39;price&#39;],
                request.form[&#39;name&#39;],
                request.form[&#39;dis&#39;],
                request.form[&#39;sold&#39;],
                request.form[&#39;cid&#39;]])
            return redirect(url_for(&#34;item&#34;,error = a,item=item_data))</code></pre>
</details>
</dd>
<dt id="skiskate.main.logs"><code class="name flex">
<span>def <span class="ident">logs</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Renders the 'logs.html' template.</p>
<h2 id="returns">Returns</h2>
<p>Flask template render response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/logs&#39;)
def logs():
    &#34;&#34;&#34;
    Renders the &#39;logs.html&#39; template.

    Returns:
        Flask template render response.
    &#34;&#34;&#34;
    return render_template(&#34;logs.html&#34;)</code></pre>
</details>
</dd>
<dt id="skiskate.main.make"><code class="name flex">
<span>def <span class="ident">make</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Initializes the database tables if they don't already exist.</p>
<h2 id="returns">Returns</h2>
<p>A simple confirmation message.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/make&#39;)
def make():
    &#34;&#34;&#34;
    Initializes the database tables if they don&#39;t already exist.

    Returns:
        A simple confirmation message.
    &#34;&#34;&#34;
    acc = sl.connect(&#39;main.db&#39;)
    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS user (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                sellerid TEXT NOT NULL,
                phone INTEGER NOT NULL,
                name TEXT,
                address TEXT, 
                city TEXT,
                state TEXT,
                zip TEXT,
                paid INTEGER
            );
        &#34;&#34;&#34;)

    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS items (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                sellerphone INTEGER NOT NULL,
                sellerid TEXT NOT NULL, 
                itemid TEXT NOT NULL, 
                itemprice INTEGER NOT NULL, 
                itemname TEXT NOT NULL,
                itemdisc TEXT,
                itemstatus INTEGER NOT NULL,
                itemcid TEXT NOT NULL
            );
        &#34;&#34;&#34;)


    with acc:
        acc.execute(&#34;&#34;&#34;
            CREATE TABLE IF NOT EXISTS log (
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
                event STRING,
                ip STRING,
                useragent STRING,
                time INTGER
            );
        &#34;&#34;&#34;)

    return &#34;Done&#34;</code></pre>
</details>
</dd>
<dt id="skiskate.main.newitem"><code class="name flex">
<span>def <span class="ident">newitem</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles item creation. Accepts POST requests to add a new item.
Displays an item creation form and error messages on GET requests.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful item creation, redirects to the 'home' route with a success message.</li>
<li>On GET request, renders the 'newitem.html' template with error and phone information.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/newitem&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def newitem():
    &#34;&#34;&#34;
    Handles item creation. Accepts POST requests to add a new item.
    Displays an item creation form and error messages on GET requests.

    Returns:
        - On successful item creation, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;newitem.html&#39; template with error and phone information.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    phone = request.args.get(&#39;phone&#39;, None)
    msg = request.args.get(&#39;msg&#39;, None)
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
                print(&#34;here&#34;)
        else:
            name = request.form[&#39;name&#39;]
        a = backend.nitem(request,name)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;Item added&#34;))
    if phone:
        return render_template(&#34;newitem.html&#34;,error = error,phone = phone,msg=msg)
    return render_template(&#34;newitem.html&#34;,error = error,msg=msg)</code></pre>
</details>
</dd>
<dt id="skiskate.main.newitem2"><code class="name flex">
<span>def <span class="ident">newitem2</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles item creation form submission. Redirects to 'newitem' with error or success msg.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/i2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def newitem2():
    &#34;&#34;&#34;
    Handles item creation form submission. Redirects to &#39;newitem&#39; with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        if str(request.form[&#39;name&#39;]) == &#34;1&#34;:
            name = request.form[&#39;tname&#39;]
            if not name:
                name = &#34;Other&#34;
        else:
            name = request.form[&#39;name&#39;]
        a = backend.nitem(request,name)
        if a !=0:
            error = a
            return redirect(url_for(&#39;newitem&#39;, error=error,phone=request.form[&#39;phonen&#39;]))
        else:
            return redirect(url_for(&#39;newitem&#39;, msg=&#34;Item added&#34;,phone=request.form[&#39;phonen&#39;]))
            #return redirect(url_for(&#39;newitem&#39;, msg=&#34;Item added&#34;))
    return redirect(url_for(&#39;newitem&#39;, error=error))</code></pre>
</details>
</dd>
<dt id="skiskate.main.print_api"><code class="name flex">
<span>def <span class="ident">print_api</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Redirects to the 'report' route for report printing.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/print&#39;)
def print_api():
    &#34;&#34;&#34;
    Redirects to the &#39;report&#39; route for report printing.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    return redirect(url_for(&#34;report&#34;))</code></pre>
</details>
</dd>
<dt id="skiskate.main.print_report"><code class="name flex">
<span>def <span class="ident">print_report</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles seller report printing.</p>
<h2 id="returns">Returns</h2>
<p>Renders the 'rec.html' template with seller and item details.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/print_report&#39;)
def print_report():
    &#34;&#34;&#34;
    Handles seller report printing.

    Returns:
        Renders the &#39;rec.html&#39; template with seller and item details.
    &#34;&#34;&#34;
    phone = request.args.get(&#39;phone&#39;, None)
    if phone:
        a =backend.getreport(phone)
        b = backend.getseller(phone)
        max_amount = 0
        notsold = 0
        sold = 0
        if a[0] ==0:
            current_item =a[1]
            b = list(b[1])
            c=[]
            for i in current_item:
                i = list(i)
                if i[7] ==0:
                    i[7]=&#34;Not Sold&#34;
                    notsold=notsold+1
                elif i[7]==1:
                    i[7] = &#34;Sold&#34;
                    max_amount =max_amount+i[4]
                    sold=sold+1
                elif i[7] == 2:
                    i[7] = &#34;Paid&#34;
                    sold=sold+1
                    max_amount =max_amount+i[4]
                elif i[7] == 3:
                    i[7] = &#34;Returned&#34;
                c.append(i)
            b[2] = backend.phone_format(str(b[2])).replace(&#34;-&#34;,&#34; &#34;)
            pay = max_amount*0.7
            if &#34;.&#34;in str(pay):
                paya = str(pay).split(&#34;.&#34;)
                pay = paya[0]+&#34;.&#34;+paya[1][:2]
            return render_template(
                &#34;rec.html&#34;, 
                item = c,
                user =b,
                sold=sold,
                payout = pay,
                seller = b[3],
                phone = b[2],
                address=b[4])

    return redirect(url_for(&#34;report&#34;))</code></pre>
</details>
</dd>
<dt id="skiskate.main.register"><code class="name flex">
<span>def <span class="ident">register</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles user registration. Accepts POST requests to register a new user.
Displays a registration form and error messages on GET requests.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful registration, redirects to the 'home' route with a success message.</li>
<li>On GET request, renders the 'register.html' template with error and message.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/register&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def register():
    &#34;&#34;&#34;
    Handles user registration. Accepts POST requests to register a new user.
    Displays a registration form and error messages on GET requests.

    Returns:
        - On successful registration, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;register.html&#39; template with error and message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    msg = request.args.get(&#39;msg&#39;, None)
    if request.method == &#39;POST&#39;:
        a = backend.newseller(request)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;User added&#34;))
    return render_template(&#39;register.html&#39;, error=error,msg=msg)</code></pre>
</details>
</dd>
<dt id="skiskate.main.register2"><code class="name flex">
<span>def <span class="ident">register2</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles user registration form submission. Goes to 'register' with error or success msg.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/r2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def register2():
    &#34;&#34;&#34;
    Handles user registration form submission. Goes to &#39;register&#39; with error or success msg.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        a = backend.newseller(request)
        if a !=0:
            error = a
        else:
            return redirect(url_for(&#39;register&#39;, msg=&#34;User added&#34;))
    return redirect(url_for(&#39;register&#39;, error=error))</code></pre>
</details>
</dd>
<dt id="skiskate.main.report"><code class="name flex">
<span>def <span class="ident">report</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles seller report generation and display. Accepts POST requests to generate reports.
Displays a report form and error messages on GET requests.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful report gen, renders the 'reporta.html' template with seller/item info.</li>
<li>On error or POST request, renders the 'report.html' template with error message.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/report&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def report():
    &#34;&#34;&#34;
    Handles seller report generation and display. Accepts POST requests to generate reports.
    Displays a report form and error messages on GET requests.

    Returns:
        - On successful report gen, renders the &#39;reporta.html&#39; template with seller/item info.
        - On error or POST request, renders the &#39;report.html&#39; template with error message.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    if request.method == &#39;POST&#39;:
        a =backend.getreport(request.form[&#39;phonen&#39;])
        b = backend.getseller(request.form[&#39;phonen&#39;])
        max_amount = 0
        notsold = 0
        sold = 0
        if a[0] ==0:

            current_item =a[1]
            b = list(b[1])
            c=[]
            for i in current_item:
                i = list(i)
                if i[7] ==0:
                    i[7]=&#34;Not Sold&#34;
                    notsold=notsold+1
                elif i[7]==1:
                    i[7] = &#34;Sold&#34;
                    max_amount =max_amount+i[4]
                    sold=sold+1
                elif i[7] == 2:
                    i[7] = &#34;Paid&#34;
                    sold=sold+1
                elif i[7] == 3:
                    i[7] = &#34;Returned&#34;
                c.append(i)
            b[2] = backend.phone_format(str(b[2])).replace(&#34;-&#34;,&#34; &#34;)
            pay = max_amount*7
            pay=pay/10
            if &#34;.&#34;in str(pay):
                paya = str(pay).split(&#34;.&#34;)
                pay = paya[0]+&#34;.&#34;+paya[1][:2]
            return render_template(
            &#34;reporta.html&#34;,
            item = c,
            user =b,
            max = max_amount,
            sold=sold,
            notsold=notsold,
            payout = pay)
        else:
            error = a
    return render_template(&#34;report.html&#34;,error=error)</code></pre>
</details>
</dd>
<dt id="skiskate.main.reportapi"><code class="name flex">
<span>def <span class="ident">reportapi</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles API requests to generate seller reports.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful report generation, returns a JSON response with a status message.</li>
<li>On error, returns a JSON response with an error status and code 418.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/r&#39;, methods=[&#39;POST&#39;])
def reportapi():
    &#34;&#34;&#34;
    Handles API requests to generate seller reports.

    Returns:
        - On successful report generation, returns a JSON response with a status message.
        - On error, returns a JSON response with an error status and code 418.
    &#34;&#34;&#34;
    pnum =request.json[&#34;phone&#34;]
    b = backend.getseller(pnum)
    if b[1][8]:
        return(jsonify({&#34;status&#34;:&#34;Error: Report already generated for this user&#34;}),418)
    a =backend.reporta(request)
    if a ==0:
        #return redirect(url_for(&#34;home&#34;,msg = &#34;Changed all items sold to paid&#34;))
        return(jsonify({&#34;status&#34;:&#34;done&#34;}),200)
    return 404</code></pre>
</details>
</dd>
<dt id="skiskate.main.seller"><code class="name flex">
<span>def <span class="ident">seller</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles seller information display and form submission for seller search.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful seller info retrieval, renders the 'user.html' template with seller details.</li>
<li>On error or POST request, renders the 'user.html' template with error message.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/seller&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def seller():
    &#34;&#34;&#34;
    Handles seller information display and form submission for seller search.

    Returns:
        - On successful seller info retrieval, renders the &#39;user.html&#39; template with seller details.
        - On error or POST request, renders the &#39;user.html&#39; template with error message.
    &#34;&#34;&#34;
    error = None
    if request.method == &#39;POST&#39;:
        a = list(backend.getseller(request.form[&#39;phonenn&#39;]))
        if a[0]==0:
            aa = list(a[1])
            aa[2] = backend.phone_format(str(aa[2])).replace(&#34;-&#34;,&#34; &#34;)
            return render_template(&#39;user.html&#39;, user=aa)
        else:
            error = a[1]
    return render_template(&#34;user.html&#34;, error=error)</code></pre>
</details>
</dd>
<dt id="skiskate.main.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles user profile update. Accepts POST requests to update user information.
Displays a user update form and error messages on GET requests.</p>
<h2 id="returns">Returns</h2>
<ul>
<li>On successful update, redirects to the 'home' route with a success message.</li>
<li>On GET request, renders the 'user.html' template for user profile update.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/update&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def update():
    &#34;&#34;&#34;
    Handles user profile update. Accepts POST requests to update user information.
    Displays a user update form and error messages on GET requests.

    Returns:
        - On successful update, redirects to the &#39;home&#39; route with a success message.
        - On GET request, renders the &#39;user.html&#39; template for user profile update.
    &#34;&#34;&#34;
    error = request.args.get(&#39;error&#39;, None)
    user = request.args.get(&#39;user&#39;, None)
    if request.method == &#39;POST&#39;:
        a = backend.updateseller(request)
        if a !=0:
            error = a
            phone = request.form[&#39;phonen&#39;]
            name = request.form[&#39;name&#39;]
            address = request.form[&#39;address&#39;]
            city = request.form[&#39;city&#39;]
            state = request.form[&#39;state&#39;]
            zip_code = request.form[&#39;zip&#39;]
            user = (1,1,phone,name,address,city,state,zip_code)
        else:
            return redirect(url_for(&#39;home&#39;, msg=&#34;User updated&#34;))
    return render_template(&#34;user.html&#34;, uerror=error , user = user)</code></pre>
</details>
</dd>
<dt id="skiskate.main.update2"><code class="name flex">
<span>def <span class="ident">update2</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Redirects to the 'seller' route.</p>
<h2 id="returns">Returns</h2>
<p>Flask redirect response.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.route(&#39;/u2&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def update2():
    &#34;&#34;&#34;
    Redirects to the &#39;seller&#39; route.

    Returns:
        Flask redirect response.
    &#34;&#34;&#34;
    return redirect(url_for(&#39;seller&#39;))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="skiskate" href="index.html">skiskate</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="skiskate.main.admin" href="#skiskate.main.admin">admin</a></code></li>
<li><code><a title="skiskate.main.api_downloadlog" href="#skiskate.main.api_downloadlog">api_downloadlog</a></code></li>
<li><code><a title="skiskate.main.api_getitem" href="#skiskate.main.api_getitem">api_getitem</a></code></li>
<li><code><a title="skiskate.main.api_getlog" href="#skiskate.main.api_getlog">api_getlog</a></code></li>
<li><code><a title="skiskate.main.api_postitems" href="#skiskate.main.api_postitems">api_postitems</a></code></li>
<li><code><a title="skiskate.main.checkout" href="#skiskate.main.checkout">checkout</a></code></li>
<li><code><a title="skiskate.main.download" href="#skiskate.main.download">download</a></code></li>
<li><code><a title="skiskate.main.download_db" href="#skiskate.main.download_db">download_db</a></code></li>
<li><code><a title="skiskate.main.goto" href="#skiskate.main.goto">goto</a></code></li>
<li><code><a title="skiskate.main.home" href="#skiskate.main.home">home</a></code></li>
<li><code><a title="skiskate.main.item" href="#skiskate.main.item">item</a></code></li>
<li><code><a title="skiskate.main.itemu" href="#skiskate.main.itemu">itemu</a></code></li>
<li><code><a title="skiskate.main.logs" href="#skiskate.main.logs">logs</a></code></li>
<li><code><a title="skiskate.main.make" href="#skiskate.main.make">make</a></code></li>
<li><code><a title="skiskate.main.newitem" href="#skiskate.main.newitem">newitem</a></code></li>
<li><code><a title="skiskate.main.newitem2" href="#skiskate.main.newitem2">newitem2</a></code></li>
<li><code><a title="skiskate.main.print_api" href="#skiskate.main.print_api">print_api</a></code></li>
<li><code><a title="skiskate.main.print_report" href="#skiskate.main.print_report">print_report</a></code></li>
<li><code><a title="skiskate.main.register" href="#skiskate.main.register">register</a></code></li>
<li><code><a title="skiskate.main.register2" href="#skiskate.main.register2">register2</a></code></li>
<li><code><a title="skiskate.main.report" href="#skiskate.main.report">report</a></code></li>
<li><code><a title="skiskate.main.reportapi" href="#skiskate.main.reportapi">reportapi</a></code></li>
<li><code><a title="skiskate.main.seller" href="#skiskate.main.seller">seller</a></code></li>
<li><code><a title="skiskate.main.update" href="#skiskate.main.update">update</a></code></li>
<li><code><a title="skiskate.main.update2" href="#skiskate.main.update2">update2</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>